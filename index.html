<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Prime Fold</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="main-container">
        <!-- Left Panel - Controls -->
        <div class="left-panel" id="leftPanel">
            <div class="header">
                <h1>Prime Fold</h1>
                <div class="mode-selector">
                    <select id="modeSelect">
                        <option value="primefold">PrimeFold (2D Embedding)</option>
                        <option value="primegen">PrimeGen (1D Generation)</option>
                    </select>
                </div>
            </div>
            
            <!-- Functions Section -->
            <div class="section" id="functionsSection">
                <h3>Functions</h3>
                <div class="function-selector" id="primefoldFunctionSelector" style="display: none;">
                    <label for="primefoldFunctionSelect">Select Preset:</label>
                    <select id="primefoldFunctionSelect">
                        <option value="ulam-sind">Ulam Spiral (n * sind(n), n * cosd(n))</option>
                        <option value="ulam-sin">Ulam Spiral (n * sin(n), n * cos(n))</option>
                        <option value="sacks">Sacks Spiral (sqrt(n) * cos(n), sqrt(n) * sin(n))</option>
                        <option value="sacks-sind">Sacks Spiral (sqrt(n) * cosd(n), sqrt(n) * sind(n))</option>
                        <option value="custom">Custom Functions</option>
                    </select>
                </div>
                <div class="function-selector" id="primegenFunctionSelector">
                    <label for="functionSelect">Select Function:</label>
                    <select id="functionSelect">
                        <option value="n*n+1">n² + 1</option>
                        <option value="n*n+n+41">n² + n + 41 (Euler)</option>
                        <option value="n*n+n+17">n² + n + 17 (Legendre)</option>
                        <option value="n*n-79*n+1601">n² - 79n + 1601</option>
                        <option value="2*n*n-2*n+53089">2n² - 2n + 53089</option>
                        <option value="36*n*n-810*n+2753">36n² - 810n + 2753 (A050268)</option>
                        <option value="47*n*n-1701*n+10181">47n² - 1701n + 10181 (A050267)</option>
                        <option value="103*n*n-4707*n+50383">103n² - 4707n + 50383</option>
                        <option value="custom">Custom Function</option>
                    </select>
                </div>
                <div class="function-display" id="primefoldFunctionDisplay" style="display: none;">
                    <div class="function-pair">
                        <div class="function-item">
                            <strong>f_x(n):</strong>
                            <div id="functionX" contenteditable="false">n * sin(n * pi / 100)</div>
                        </div>
                        <div class="function-item">
                            <strong>f_y(n):</strong>
                            <div id="functionY" contenteditable="false">n * cos(n * pi / 100)</div>
                        </div>
                        <div class="function-pair-stats">
                            <div>Score: <span id="primefoldCombinedScore">0.000</span> | Complexity: <span id="primefoldCombinedComplexity">1</span></div>
                        </div>
                    </div>
                </div>
                <div class="function-display" id="primegenFunctionDisplay">
                    <div class="main-function">
                        <strong>Function:</strong>
                        <span id="mainFunctionLabel">f(n) =</span>
                        <div id="mainFunction" contenteditable="false">n * n + n + 41</div>
                        <div>Score: <span id="mainFunctionScore">0.000</span> | Complexity: <span id="mainFunctionComplexity">1</span></div>
                        <div>Unique Numbers: <span id="mainFunctionUniqueNumbers">0</span> | Unique Primes: <span id="mainFunctionUniquePrimes">0</span></div>
                    </div>
                </div>
            </div>
            
            <!-- Generate Functions Section -->
            <div class="section">
                <h3>Generate Functions</h3>
                <!-- Fitness Function Section (PrimeFold mode only) -->
                <div class="section" id="fitness-section" style="display: none;">
                    <h3>Fitness Function</h3>
                    <form id="fitness-metrics-form">
                        <div class="fitness-metric-row">
                            <input type="checkbox" id="metric-areaCoverage" checked>
                            <label for="metric-areaCoverage">Area Coverage</label>
                            <input type="number" id="weight-areaCoverage" class="fitness-weight" min="0" max="1" step="0.01" value="0.50" title="Weight: How much this metric influences the final fitness score (0-1). Higher values = more important.&#10;&#10;Area Coverage = Hull Area × Isotropy × Scale Balance&#10;&#10;Hull Area: Convex hull ratio (0-1)&#10;Isotropy: PCA-based non-linearity measure&#10;Scale Balance: Penalizes extreme range imbalances&#10;&#10;Blocks lines, encourages 2D coverage">
                            <input type="number" id="threshold-areaCoverage" class="fitness-threshold" min="0" max="1" step="0.01" value="0.50" placeholder="Threshold" title="Minimum required area coverage score. Patterns below this threshold get very low fitness scores.&#10;&#10;Threshold acts as prerequisite gate - only patterns meeting this minimum get evaluated further.">
                        </div>
                        <div class="fitness-metric-row">
                            <input type="checkbox" id="metric-separation" checked>
                            <label for="metric-separation">Separation</label>
                            <input type="number" id="weight-separation" class="fitness-weight" min="0" max="1" step="0.01" value="0.25" title="Weight: How much this metric influences the final fitness score (0-1). Higher values = more important.&#10;&#10;Separation = Avg distance (primes → nearest composites)&#10;&#10;Measures spatial separation between prime and composite distributions&#10;Higher scores = primes are further from composites&#10;Uses nearest neighbor distance calculation&#10;&#10;Ensures prime patterns are distinct from composite patterns">
                        </div>
                        <div class="fitness-metric-row">
                            <input type="checkbox" id="metric-contrast" checked>
                            <label for="metric-contrast">Contrast</label>
                            <input type="number" id="weight-contrast" class="fitness-weight" min="0" max="1" step="0.01" value="0.20" title="Weight: How much this metric influences the final fitness score (0-1). Higher values = more important.&#10;&#10;Contrast = Prime Regularity / Composite Regularity&#10;&#10;Measures local density variance in both distributions&#10;Higher scores = primes are more organized than composites&#10;Uses coefficient of variation of local point densities&#10;&#10;Ensures prime patterns show more structure than composite patterns">
                        </div>
                        <div class="fitness-metric-row">
                            <input type="checkbox" id="metric-significance" checked>
                            <label for="metric-significance">Significance</label>
                            <input type="number" id="weight-significance" class="fitness-weight" min="0" max="1" step="0.01" value="0.10" title="Weight: How much this metric influences the final fitness score (0-1). Higher values = more important.&#10;&#10;Significance = (Prime vs Random) - (Composite vs Random)&#10;&#10;Compares distributions to random baseline&#10;Higher scores = primes differ more from random than composites&#10;Uses Jensen-Shannon divergence and spatial statistics&#10;&#10;Ensures patterns are statistically significant, not random">
                        </div>
                        <div class="fitness-metric-row">
                            <input type="checkbox" id="metric-specificity" checked>
                            <label for="metric-specificity">Specificity</label>
                            <input type="number" id="weight-specificity" class="fitness-weight" min="0" max="1" step="0.01" value="0.05" title="Weight: How much this metric influences the final fitness score (0-1). Higher values = more important.&#10;&#10;Specificity = Clustering Quality + Pattern Uniqueness&#10;&#10;Measures how well primes cluster and form unique patterns&#10;Higher scores = more distinctive prime-specific patterns&#10;Uses clustering analysis and pattern detection algorithms&#10;&#10;Ensures patterns are unique to primes, not general number properties">
                        </div>
                    </form>
                    <div id="fitness-formula-preview" class="fitness-formula-preview"></div>
                    <button id="fitness-reset-btn" type="button">Reset to Default</button>
                    <div id="fitness-warning" class="fitness-warning" style="color: #b00; margin-top: 8px; display: none;"></div>
                    
                    <!-- Symmetry Option (PrimeFold mode only) -->
                    <div class="fitness-option-row" id="symmetry-option" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enforceSymmetry" title="When enabled, f_x(n) and f_y(n) will be symmetrical transformations of each other (e.g., sin/cos pairs). Only one function is mutated, the other is automatically derived.">
                            <span class="checkmark"></span>
                            Enforce Symmetry
                        </label>
                    </div>

                </div>
                <div class="param-row">
                    <div class="param-group">
                        <label for="algorithm">Algorithm:</label>
                        <select id="algorithm" title="LAHC: Fast hill climbing with memory, good for most cases&#10;GA: Genetic algorithm, explores complex solution spaces&#10;SA: Simulated annealing, good for escaping local optima">
                            <option value="lahc">LAHC</option>
                            <option value="ga">GA</option>
                            <option value="sa">SA</option>
                        </select>
                    </div>
                    <div class="param-group">
                        <label for="iterations">Iterations:</label>
                        <input type="number" id="iterations" value="500" min="100" max="2000" title="Number of optimization steps. Higher values = better results but longer runtime. 500-1000 is usually sufficient.">
                    </div>
                </div>
                <div class="param-row">
                    <div class="param-group">
                        <label for="sampleSize">Sample Size:</label>
                        <input type="number" id="sampleSize" value="200" min="50" max="500" style="width: 80px;" title="Number of prime/composite numbers to evaluate. Larger samples = more accurate but slower. 200-300 is a good balance.">
                    </div>
                </div>
                <div class="param-row" id="lahc-params">
                    <div class="param-group">
                        <label for="historyLength">History Length:</label>
                        <input type="number" id="historyLength" value="50" min="10" max="200" title="LAHC memory size. Higher values = more exploration but slower convergence. 30-100 is typical.">
                    </div>
                </div>
                <div class="param-row" id="ga-params" style="display: none;">
                    <div class="param-group">
                        <label for="populationSize">Population Size:</label>
                        <input type="number" id="populationSize" value="10" min="20" max="100" title="Number of candidate solutions in genetic algorithm. Larger populations = better exploration but slower. 30-80 is effective.">
                    </div>
                </div>
                <div class="param-row" id="sa-params" style="display: none;">
                    <div class="param-group">
                        <label for="startTemp">Start Temperature:</label>
                        <input type="number" id="startTemp" value="10" min="1" max="100" step="0.1" title="Initial temperature for simulated annealing. Higher values = more random exploration early on. 5-20 is typical.">
                    </div>
                </div>
                
                <!-- Start/Stop button moved here -->
                <div class="button-group">
                    <button id="generateBtn" class="btn primary">Start</button>
                </div>
                
                <!-- Progress Section moved here -->
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
                <div class="score-display">
                    <div>Last Score: <span id="currentScore">0.000</span></div>
                    <div>Best: <span id="bestScore">0.000</span></div>
                </div>
                
                <!-- Last Generated moved here -->
                <div class="last-generated-function">
                    <strong>Last Generated:</strong>
                    <span id="lastGeneratedLabel">f(n) =</span>
                    <span id="lastGeneratedFunction">n * n + n + 41</span>
                </div>
            </div>
            
            <!-- Statistics Section -->
            <div class="section">
                <h3 id="statsTitle">Statistics for Sample Size: 200</h3>
                <div id="primefold-stats" class="stats-display">
                    <div class="stat-row">
                        <div class="stat-item">
                            <span class="stat-label">Area Coverage:</span>
                            <span class="stat-value">0.000</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Separation:</span>
                            <span class="stat-value">0.000</span>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-item">
                            <span class="stat-label">Contrast:</span>
                            <span class="stat-value">0.000</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Significance:</span>
                            <span class="stat-value">0.000</span>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-item">
                            <span class="stat-label">Specificity:</span>
                            <span class="stat-value">0.000</span>
                        </div>
                    </div>
                </div>
                <div id="primegen-stats" class="stats-display" style="display: none;">
                    <div class="stat-row">
                        <div class="stat-item">
                            <span class="stat-label">Unique Numbers:</span>
                            <span class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Unique Primes:</span>
                            <span class="stat-value">0</span>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-item">
                            <span class="stat-label">Hit Ratio:</span>
                            <span class="stat-value">0.000</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Actions Section -->
            <div class="section">
                <h3>Actions</h3>
                <div class="button-group">
                    <button id="exportBtn" class="btn secondary" title="Export the current best function to clipboard for use in other applications.">Export Function</button>
                    <button id="helpBtn" class="btn secondary" title="Show detailed help and usage instructions.">Help</button>
                </div>
            </div>
        </div>
        
        <!-- Vertical Resizer -->
        <div class="resizer" id="verticalResizer"></div>
        
        <!-- Right Panel - Visualization -->
        <div class="right-panel" id="rightPanel">
            <div class="visualization-header">
                <div class="visualization-title-section">
                    <h2 id="visualizationTitle">PrimeFold Visualization</h2>
                    <div class="visualization-controls-row">
                        <div class="visualization-options">
                            <div class="display-points-control">
                                <label for="displayPoints">Display Points:</label>
                                <input type="number" id="displayPoints" value="10000" min="20" max="100000" title="Number of points to render in visualization. Higher values = more detail but slower performance. 5000-20000 is usually good.">
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" id="showNonPrimes" checked title="Show composite numbers as gray points. Uncheck to focus only on prime patterns.">
                                <span class="checkmark"></span>
                                Show Non-Primes
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="scalePoints" title="Scale point sizes based on their values. Larger points = larger function values.">
                                <span class="checkmark"></span>
                                Scale Points
                            </label>
                            <div class="point-size-control" id="pointSizeControl">
                                <label for="pointSize">Size:</label>
                                <input type="number" id="pointSize" value="2" min="0.5" max="10" step="0.5" title="Base size of rendered points. Adjust for better visibility on different screen sizes.">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="visualization-controls" id="zoomControls">
                    <button id="zoomInBtn" class="btn small" title="Zoom in to see more detail. You can also use mouse wheel or drag to pan.">Zoom In</button>
                    <button id="zoomOutBtn" class="btn small" title="Zoom out to see the full pattern. You can also use mouse wheel or drag to pan.">Zoom Out</button>
                    <button id="resetViewBtn" class="btn small" title="Reset zoom and pan to show the entire visualization.">Reset View</button>
                </div>
            </div>
            <div class="visualization-container" id="visualizationContainer">
                <canvas id="visualizationCanvas" width="800" height="600"></canvas>
            </div>
            
            <!-- Horizontal Resizer -->
            <div class="resizer horizontal" id="horizontalResizer"></div>
            
            <!-- Log Section -->
            <div class="log-section" id="logSection">
                <div class="log-header">
                    <h3>Log</h3>
                    <div class="log-controls">
                        <button id="clearLogBtn" class="btn small" title="Clear all log entries.">Clear</button>
                        <button id="copyLogBtn" class="btn small" title="Copy all log entries to clipboard.">Copy</button>
                    </div>
                </div>
                <div id="logContainer" class="log-container">
                    <div class="log-entry">Application started. Ready to generate functions.</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div id="helpModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Prime Fold Finder Help</h2>
            <div class="help-content">
                <h3>PrimeFold Mode (2D Embedding)</h3>
                <p>Finds functions f(n) and g(n) that map prime numbers to well-distributed 2D points with interesting patterns.</p>
                <ul>
                    <li><strong>Separation:</strong> Measures spatial distance between prime and non-prime distributions</li>
                    <li><strong>Contrast:</strong> Measures how much more organized primes are compared to non-primes</li>
                    <li><strong>Significance:</strong> Ensures patterns are statistically meaningful vs random data</li>
                    <li><strong>Specificity:</strong> Ensures patterns are unique to primes, not general number properties</li>
                    <li><strong>Area Coverage:</strong> Prevents line generation and encourages 2D area-covering patterns</li>
                    <li><strong>Symmetry:</strong> When enabled, ensures f(n) and g(n) are symmetrical transformations (e.g., sin/cos pairs)</li>
                </ul>
                <h3>PrimeGen Mode (1D Generation)</h3>
                <p>Finds function f(n) that generates many unique prime numbers.</p>
                <ul>
                    <li><strong>Hit Ratio:</strong> Ratio of unique primes generated to total range</li>
                    <li><strong>Unique Numbers:</strong> How many different numbers are generated</li>
                    <li><strong>Unique Primes:</strong> How many of those are prime</li>
                </ul>
                <h3>Algorithms</h3>
                <ul>
                    <li><strong>LAHC:</strong> Late Acceptance Hill Climbing - fast and effective</li>
                    <li><strong>GA:</strong> Genetic Algorithm - good for complex functions</li>
                    <li><strong>SA:</strong> Simulated Annealing - good exploration</li>
                </ul>
                <h3>Parameters</h3>
                <ul>
                    <li><strong>Sample Size:</strong> Number of primes/composites to evaluate</li>
                    <li><strong>Display Points:</strong> Number of points to show in visualization</li>
                    <li><strong>Iterations:</strong> Number of optimization iterations</li>
                </ul>
                <h3>Writing Expressions</h3>
                <p>You can enter mathematical expressions to define functions for visualizing or generating primes. Expressions use the variable <code>n</code> and support a variety of operators, functions, and constants.</p>
                <ul>
                    <li><strong>PrimeFold mode:</strong> Enter two expressions, separated by a comma, e.g. <code>f_x(n) = n, f_y(n) = n^2</code> or simply <code>n, n^2</code>.</li>
                    <li><strong>PrimeGen mode:</strong> Enter a single expression, e.g. <code>f(n) = 2*n + 1</code> or just <code>2*n + 1</code>.</li>
                </ul>
                <h4>Operators</h4>
                <table style="width:100%; font-size:13px; margin-bottom:10px;">
                    <tr><th>Operator</th><th>Description</th><th>Example</th></tr>
                    <tr><td>+</td><td>Addition</td><td>n + 2</td></tr>
                    <tr><td>-</td><td>Subtraction</td><td>n - 1</td></tr>
                    <tr><td>*</td><td>Multiplication</td><td>2 * n</td></tr>
                    <tr><td>/</td><td>Division</td><td>n / 3</td></tr>
                    <tr><td>%</td><td>Modulo (remainder)</td><td>n % 2</td></tr>
                    <tr><td>mod</td><td>Modulo (alternative)</td><td>n mod 2</td></tr>
                    <tr><td>^</td><td>Exponentiation</td><td>n^2</td></tr>
                </table>
                <h4>Functions</h4>
                <table style="width:100%; font-size:13px; margin-bottom:10px;">
                    <tr><th>Function</th><th>Description</th><th>Example</th></tr>
                    <tr><td>sin(x)</td><td>Sine (radians)</td><td>sin(n)</td></tr>
                    <tr><td>cos(x)</td><td>Cosine (radians)</td><td>cos(n)</td></tr>
                    <tr><td>sind(x)</td><td>Sine (degrees)</td><td>sind(n)</td></tr>
                    <tr><td>cosd(x)</td><td>Cosine (degrees)</td><td>cosd(n)</td></tr>
                    <tr><td>sqrt(x)</td><td>Square root</td><td>sqrt(n)</td></tr>
                    <tr><td>log(x)</td><td>Natural logarithm</td><td>log(n)</td></tr>
                    <tr><td>abs(x)</td><td>Absolute value</td><td>abs(n-10)</td></tr>
                    <tr><td>floor(x)</td><td>Floor (round down)</td><td>floor(n/2)</td></tr>
                    <tr><td>ceil(x)</td><td>Ceiling (round up)</td><td>ceil(n/2)</td></tr>
                    <tr><td>square(x)</td><td>Square (x^2)</td><td>square(n)</td></tr>
                    <tr><td>cube(x)</td><td>Cube (x^3)</td><td>cube(n)</td></tr>
                </table>
                <h4>Constants</h4>
                <table style="width:100%; font-size:13px; margin-bottom:10px;">
                    <tr><th>Name</th><th>Value</th></tr>
                    <tr><td>pi</td><td>3.141592...</td></tr>
                    <tr><td>e</td><td>2.718281...</td></tr>
                    <tr><td>sqrt2</td><td>1.414213...</td></tr>
                    <tr><td>phi</td><td>1.618033... (golden ratio)</td></tr>
                </table>
                <h4>Syntax Tips</h4>
                <ul>
                    <li>Use parentheses <code>()</code> to group expressions: <code>(n + 1) * 2</code></li>
                    <li>Both <code>^</code> and <code>square(x)</code>, <code>cube(x)</code> are supported for powers.</li>
                    <li><code>mod</code> and <code>%</code> are equivalent for modulo.</li>
                    <li>All functions take a single argument: <code>sin(n)</code>, <code>sqrt(n+1)</code>, etc.</li>
                    <li>You can omit <code>f(n) =</code> or <code>f_x(n) =</code>/<code>f_y(n) =</code> and just write the expressions directly.</li>
                    <li>Spaces are ignored.</li>
                </ul>
                <h4>Examples</h4>
                <b>PrimeFold (2D):</b>
                <ul>
                    <li><code>f_x(n) = n, f_y(n) = n^2</code></li>
                    <li><code>n, n^2</code></li>
                    <li><code>sin(n), cos(n)</code></li>
                    <li><code>n, n mod 5</code></li>
                    <li><code>sqrt(n), log(n)</code></li>
                </ul>
                <b>PrimeGen (1D):</b>
                <ul>
                    <li><code>f(n) = 2*n + 1</code></li>
                    <li><code>n^2 + 1</code></li>
                    <li><code>abs(n-10)</code></li>
                    <li><code>cube(n) - 1</code></li>
                </ul>
                <p>If you enter an invalid expression, check the browser console for errors. For more details, see the README or the Expressions Guide in the repository.</p>
            </div>
        </div>
    </div>
    
    <!-- Core libraries -->
    <script src="js/core/tree.js"></script>
    <script src="js/core/parser.js"></script>
    <script src="js/core/compile.js"></script>
    <script src="js/core/prime-cache.js"></script>
    <script src="js/core/evaluators.js"></script>
    <script src="js/core/optimizers.js"></script>
    
    <!-- GUI components -->
    <script src="js/gui/canvas.js"></script>
    
    <!-- Main application -->
    <script src="js/main.js"></script>
</body>
</html> 